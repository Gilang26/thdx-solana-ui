<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Multi Token Bridge ‚Ä¢ Sepolia ‚Üí Monad (Wormhole)</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body { background:#0b1220; color:#fff; font-family:sans-serif; text-align:center; padding:20px; }
h2 { color:#7c5cff; }
select, input, button, textarea { width:90%; padding:12px; margin:8px 0; border-radius:8px; border:0; font-size:15px; }
button { cursor:pointer; font-weight:bold; color:white; }
#connect { background:linear-gradient(90deg,#6ee7ff,#7c5cff); }
#approve { background:linear-gradient(90deg,#22c55e,#16a34a); }
#bridge { background:linear-gradient(90deg,#facc15,#eab308); }
#redeem { background:linear-gradient(90deg,#7c5cff,#6ee7ff); }
pre { text-align:left; background:#111a2e; padding:10px; border-radius:8px; white-space:pre-wrap; word-break:break-all; }
</style>
</head>
<body>

<h2>üåâ Multi Token Bridge</h2>
<p>Sepolia ‚Üí Monad Testnet via Wormhole</p>

<select id="token">
  <option value="USDC">USDC</option>
  <option value="USDT">USDT</option>
  <option value="WBTC">WBTC</option>
</select>

<input id="amount" placeholder="Masukkan jumlah token" />
<button id="connect">üîå Connect Wallet</button>
<button id="approve" disabled>‚úÖ Approve Token</button>
<button id="bridge" disabled>üöÄ Bridge ke Monad</button>

<h3>Redeem VAA di Monad</h3>
<textarea id="vaa" placeholder="Tempel Signed VAA (hex hasil converter) di sini"></textarea>
<button id="redeem" disabled>üîÅ Redeem VAA</button>

<pre id="log">Log siap...</pre>

<script>
const TOKENS = {
  USDC: "0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238",
  USDT: "0xaA8E23Fb1079EA71e0a56F48a2aA51851D8433D0",
  WBTC: "0x52eeA312378ef46140EBE67dE8a143BA2304FD7C"
};

const BRIDGE = "0x6c5aAE4622B835058A41879bA5e128019B9047d6";
const DST_CHAIN = 31041; // Wormhole Monad Testnet ChainID

let provider, signer, user;

function log(m){ const el=document.getElementById("log"); el.textContent+="\n"+m; el.scrollTop=el.scrollHeight; console.log(m); }

async function connect(){
  try{
    if(!window.ethereum) throw new Error("Gunakan MetaMask / OKX Wallet");
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    user = await signer.getAddress();
    const net = await provider.getNetwork();
    log(`‚úÖ Connected: ${user}\nChain: ${net.chainId}`);
    document.getElementById("approve").disabled = false;
    document.getElementById("redeem").disabled = false;
  }catch(e){ log("‚ùå "+e.message); }
}

async function approveToken(){
  try{
    const symbol = document.getElementById("token").value;
    const tokenAddr = TOKENS[symbol];
    const amount = document.getElementById("amount").value.trim();
    if(!amount) return log("‚ö†Ô∏è Masukkan jumlah token dulu");
    const decimals = symbol === "WBTC" ? 8 : 6;
    const amt = ethers.utils.parseUnits(amount, decimals);
    const erc20 = new ethers.Contract(tokenAddr, ["function approve(address,uint256) returns (bool)"], signer);
    const tx = await erc20.approve(BRIDGE, amt);
    log(`üßæ Approve ${symbol}: ${tx.hash}`);
    await tx.wait();
    log(`‚úÖ Approve ${symbol} sukses!`);
    document.getElementById("bridge").disabled = false;
  }catch(e){ log("‚ùå "+e.message); }
}

async function bridgeToken(){
  try{
    const symbol = document.getElementById("token").value;
    const tokenAddr = TOKENS[symbol];
    const amount = document.getElementById("amount").value.trim();
    if(!amount) return log("‚ö†Ô∏è Masukkan jumlah token dulu");
    const decimals = symbol === "WBTC" ? 8 : 6;
    const amt = ethers.utils.parseUnits(amount, decimals);
    const recipientBytes = "0x" + user.slice(2).padStart(64, "0");
    const abi = ["function transferTokens(address,uint256,uint16,bytes32,uint256,uint32)"];
    const bridge = new ethers.Contract(BRIDGE, abi, signer);
    const nonce = Math.floor(Math.random() * 1e9);
    log(`üöÄ Mengirim ${amount} ${symbol} ke Monad...`);
    const tx = await bridge.transferTokens(tokenAddr, amt, DST_CHAIN, recipientBytes, 0, nonce);
    log(`üì¶ Bridge TX: ${tx.hash}`);
    await tx.wait();
    log(`‚úÖ ${symbol} berhasil di-bridge ke Monad! Tunggu VAA untuk redeem.`);
  }catch(e){ log("‚ùå "+e.message); }
}

async function redeemVAA(){
  try{
    const hexVAA = document.getElementById("vaa").value.trim();
    if(!hexVAA.startsWith("0x")) throw new Error("Format harus hex (awali 0x)");
    const abi = ["function completeTransfer(bytes memory encodedVm)"];
    const bridge = new ethers.Contract(BRIDGE, abi, signer);
    log("üîÅ Mengirim redeem VAA ke Wormhole bridge...");
    const tx = await bridge.completeTransfer(hexVAA);
    log(`üì¶ Redeem TX: ${tx.hash}`);
    await tx.wait();
    log("‚úÖ Redeem sukses! Token muncul di Monad.");
  }catch(e){ log("‚ùå "+e.message); }
}

document.getElementById("connect").onclick = connect;
document.getElementById("approve").onclick = approveToken;
document.getElementById("bridge").onclick = bridgeToken;
document.getElementById("redeem").onclick = redeemVAA;
</script>
</body>
</html>
