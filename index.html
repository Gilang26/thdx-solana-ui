<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>THDX ‚Ä¢ Solana NFT UI</title>

  <!-- ‚úÖ Solana Web3.js bundle khusus browser (sudah dengan Buffer polyfill) -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.browser.min.js"></script>
  <script>
    // ‚úÖ Fallback: pastikan variabel solanaWeb3 global selalu tersedia
    window.solanaWeb3 = window.solanaWeb3 || window.web3js || window.web3 || window.solana || {};
  </script>

  <style>
    body {
      background:#0b1220;
      color:#e6edf3;
      font-family:system-ui,Arial,sans-serif;
      margin:0;
      display:grid;
      place-items:center;
      height:100vh;
    }
    .card {
      background:#121a2a;
      border:1px solid #22304a;
      border-radius:12px;
      padding:24px;
      width:min(420px,90vw);
      box-shadow:0 4px 12px rgba(0,0,0,.3);
      text-align:center;
    }
    input,button {
      width:100%;
      padding:12px;
      border-radius:10px;
      border:0;
      font-size:15px;
      margin-top:8px;
    }
    button {
      cursor:pointer;
      font-weight:700;
      transition:.2s;
    }
    #connect { background:linear-gradient(90deg,#7c5cff,#6ee7ff); }
    #send { background:linear-gradient(90deg,#22c55e,#15803d); }
    pre {
      white-space:pre-wrap;
      background:#0f1625;
      border:1px solid #22304a;
      border-radius:10px;
      padding:10px;
      text-align:left;
      font-size:13px;
      margin-top:10px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>üí† THDX ‚Ä¢ Solana NFT UI</h2>
    <p>Power UI for ExecuteSale Transaction</p>
    <button id="connect">üîå Connect Wallet</button>
    <input id="seller" placeholder="Alamat Seller (contoh: 6a8XJs...)" />
    <input id="amount" type="number" placeholder="Harga NFT (SOL)" />
    <button id="send" disabled>üöÄ Kirim / Execute</button>
    <pre id="log">Log siap...</pre>
  </div>

  <script>
    const log = (m) => {
      const el = document.getElementById("log");
      el.textContent += "\n" + m;
      el.scrollTop = el.scrollHeight;
      console.log(m);
    };

    let provider = null;
    let pubkey = null;

    async function connectWallet() {
      try {
        if (window.solana && window.solana.isPhantom) {
          const resp = await window.solana.connect();
          provider = window.solana;
          pubkey = resp.publicKey;
          log("‚úÖ Connected: " + pubkey.toString());
          document.getElementById("send").disabled = false;
        } else {
          log("‚ùå Wallet tidak terdeteksi. Gunakan browser wallet seperti OKX atau Phantom.");
        }
      } catch (err) {
        log("‚ùå Connect error: " + err.message);
      }
    }

    async function sendSol() {
      try {
        if (!provider || !pubkey) return log("‚ö†Ô∏è Hubungkan wallet dulu.");
        const seller = document.getElementById("seller").value.trim();
        const amountSol = parseFloat(document.getElementById("amount").value);
        if (!seller || isNaN(amountSol)) return log("‚ö†Ô∏è Isi alamat seller dan jumlah SOL.");

        const connection = new solanaWeb3.Connection("https://rpc.ankr.com/solana", "confirmed");
        const txn = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: pubkey,
            toPubkey: new solanaWeb3.PublicKey(seller),
            lamports: amountSol * solanaWeb3.LAMPORTS_PER_SOL
          })
        );

        txn.feePayer = pubkey;
        const { blockhash } = await connection.getLatestBlockhash();
        txn.recentBlockhash = blockhash;

        const signed = await provider.signTransaction(txn);
        const sig = await connection.sendRawTransaction(signed.serialize());
        log("üöÄ TX sent: " + sig);
        await connection.confirmTransaction(sig, "confirmed");
        log("‚úÖ Transaksi selesai!");
      } catch (err) {
        log("‚ùå Error: " + (err.message || err));
      }
    }

    document.getElementById("connect").onclick = connectWallet;
    document.getElementById("send").onclick = sendSol;
  </script>
</body>
</html>
